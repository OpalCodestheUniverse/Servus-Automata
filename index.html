const BASE_URL = 'https://eldenring.wiki.fextralife.com/';

function fetchPageContent(keyword) {
    const formattedKeyword = keyword.replace(' ', '+');
    const url = `${BASE_URL}${formattedKeyword}`;

    return fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .catch(error => {
            console.error('Error fetching content:', error);
            return null;
        });
}

function extractHeadersAndParagraphs(content) {
    const parser = new DOMParser();
    const htmlDoc = parser.parseFromString(content, 'text/html');

    const headersAndParagraphs = [];

    const headers = htmlDoc.querySelectorAll('h1, h2, h3');
    headers.forEach(header => {
        const headerText = header.textContent.trim();
        let paragraphText = '';
        let nextElement = header.nextElementSibling;
        while (nextElement && !['h1', 'h2', 'h3'].includes(nextElement.tagName.toLowerCase())) {
            paragraphText += nextElement.textContent.trim() + '\n\n';
            nextElement = nextElement.nextElementSibling;
        }
        headersAndParagraphs.push([headerText, paragraphText]);
    });

    return headersAndParagraphs;
}

function formatContent(headersAndParagraphs) {
    let formattedContent = '';
    headersAndParagraphs.forEach(([header, paragraph]) => {
        formattedContent += `**${header}**\n\n${paragraph}\n`;
    });
    return formattedContent;
}

function fetchAndDisplayInfo(keyword) {
    fetchPageContent(keyword)
        .then(content => {
            if (content) {
                const headersAndParagraphs = extractHeadersAndParagraphs(content);
                const formattedContent = formatContent(headersAndParagraphs);
                console.log(formattedContent);
                console.log("Another query, simpleton?");
            } else {
                console.log("No content fetched.");
            }
        });
}

function exitProgram() {
    console.log("I suppose you're on your own then, dolt.");
    setTimeout(() => {
        process.exit();
    }, 10000); // Wait for 10 seconds before exiting
}

function main() {
    const readlineSync = require('readline-sync');

    const asciiArt = `
    Place your ASCII art here.
    `;

    const asciiLines = asciiArt.split('\n');
    const longestLineLength = asciiLines.reduce((maxLength, line) => Math.max(maxLength, line.length), 0);

    const horizontalPadding = ' '.repeat(Math.floor((process.stdout.columns - longestLineLength) / 2));

    console.log(horizontalPadding);
    asciiLines.forEach(line => console.log(horizontalPadding + line));

    console.log("\nYou have summoned me. What knowledge do you seek, Tarnished?");
    while (true) {
        const keyword = readlineSync.question("Enter your query (Enter 'exit' to quit): ");
        if (keyword.toLowerCase() === 'exit') {
            exitProgram();
            break;
        }
        fetchAndDisplayInfo(keyword);
    }
}

main();
