const BASE_URL = 'https://eldenring.wiki.fextralife.com/';

function fetchPageContent(keyword) {
    const formattedKeyword = keyword.replace(' ', '+');
    const url = `${BASE_URL}${formattedKeyword}`;

    return fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .catch(error => {
            console.error('Error fetching content:', error);
            return null;
        });
}

function extractHeadersAndParagraphs(content) {
    const parser = new DOMParser();
    const htmlDoc = parser.parseFromString(content, 'text/html');

    const headersAndParagraphs = [];
    const headers = htmlDoc.querySelectorAll('h1, h2, h3');
    headers.forEach(header => {
        const headerText = header.textContent.trim();
        let paragraphText = '';
        let nextElement = header.nextElementSibling;
        while (nextElement && !['h1', 'h2', 'h3'].includes(nextElement.tagName.toLowerCase())) {
            paragraphText += nextElement.textContent.trim() + '<br><br>';
            nextElement = nextElement.nextElementSibling;
        }
        headersAndParagraphs.push([headerText, paragraphText]);
    });

    return headersAndParagraphs;
}

function formatContent(headersAndParagraphs) {
    let formattedContent = '';
    headersAndParagraphs.forEach(([header, paragraph]) => {
        formattedContent += `<strong>${header}</strong><br>${paragraph}<br>`;
    });
    return formattedContent;
}

function fetchAndDisplayInfo(keyword) {
    fetchPageContent(keyword)
        .then(content => {
            if (content) {
                const headersAndParagraphs = extractHeadersAndParagraphs(content);
                const formattedContent = formatContent(headersAndParagraphs);
                document.getElementById('output').innerHTML = formattedContent;
            } else {
                document.getElementById('output').innerHTML = "No content fetched.";
            }
        });
}

function exitProgram() {
    console.log("I suppose you're on your own then, dolt.");
    setTimeout(() => {
        window.close();
    }, 10000); // Wait for 10 seconds before exiting
}

function main() {
    const asciiArt = `Place your ASCII art here.`;
    const asciiLines = asciiArt.split('\n');
    const longestLineLength = asciiLines.reduce((maxLength, line) => Math.max(maxLength, line.length), 0);
    const horizontalPadding = ' '.repeat(Math.floor((window.innerWidth - longestLineLength) / 2));

    const asciiElement = document.getElementById('ascii');
    asciiLines.forEach(line => {
        const lineElement = document.createElement('div');
        lineElement.textContent = horizontalPadding + line;
        asciiElement.appendChild(lineElement);
    });

    const inputElement = document.createElement('input');
    inputElement.type = 'text';
    inputElement.placeholder = "Enter your query (Enter 'exit' to quit)";
    document.body.appendChild(inputElement);

    const buttonElement = document.createElement('button');
    buttonElement.textContent = 'Submit';
    buttonElement.addEventListener('click', () => {
        const keyword = inputElement.value;
        if (keyword.toLowerCase() === 'exit') {
            exitProgram();
        } else {
            fetchAndDisplayInfo(keyword);
        }
    });
    document.body.appendChild(buttonElement);
}

main();

