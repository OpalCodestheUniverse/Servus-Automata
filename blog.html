<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Archive</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>

    <header>
        <h1>Blog Archive</h1>
    </header>

    <main>
        <div id="loader">Fetching latest posts...</div>
        <div id="archive-container"></div>
    </main>

    <script>
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRShpKrg7NQN1m8ysGHQeqtO2df_Mc7PQ-ng18Rmsq6DYJ0btvauuhmc1ShHFwrAUVTdj3OsMgGHD53/pub?gid=0&single=true&output=csv';

        async function fetchPosts() {
            try {
                const response = await fetch(sheetUrl);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    complete: function(results) {
                        const container = document.getElementById('archive-container');
                        const loader = document.getElementById('loader');
                        if (loader) loader.style.display = 'none';

                        results.data.forEach((post, index) => {
                            if (!post.Title) return;

                            const postHtml = `
                                <article class="post-card">
                                    <header class="post-meta">
                                        <span class="date">${post.Date}</span> | 
                                        <span class="category">${post.Category}</span>
                                    </header>
                                    <h3>${post.Title}</h3>
                                    <a href="post.html?id=${index}" class="read-more">Read Post &rarr;</a>
                                </article>
                            `;
                            container.innerHTML += postHtml;
                        });
                    }
                });
            } catch (error) {
                console.error("Error loading sheet:", error);
                document.getElementById('loader').innerText = "Failed to load posts.";
            }
        }
        fetchPosts();
    </script>
</body>
</html>
